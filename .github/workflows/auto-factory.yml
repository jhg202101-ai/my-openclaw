name: Gemini API smoke test

on:
  workflow_dispatch:
  push:

jobs:
  gemini-smoke:
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "22"

      - name: Gemini smoke test
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          set -e

          echo "▶ Installing Gemini SDK"
          npm install @google/generative-ai

          echo "▶ Running Gemini smoke test"
          node << 'EOF'
          const { GoogleGenerativeAI } = require("@google/generative-ai");

          const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);
          const model = genAI.getGenerativeModel({ model: "gemini-1.5-pro" });

          async function main() {
            const result = await model.generateContent("Hello from GitHub Actions");
            console.log("▶ Gemini response:");
            console.log(result.response.text());
          }

          main().catch(err => {
            console.error(err);
            process.exit(1);
          });
          EOF
